#!/bin/sh
#
#  ________  ___       __   ___  ________
# |\   ____\|\  \     |\  \|\  \|\   ____\
# \ \  \___|\ \  \    \ \  \ \  \ \  \___|
#  \ \_____  \ \  \  __\ \  \ \  \ \  \  ___
#   \|____|\  \ \  \|\__\_\  \ \  \ \  \|\  \
#     ____\_\  \ \____________\ \__\ \_______\
#    |\_________\|____________|\|__|\|_______|
#    \|_________|

#    It's delicious.
#    Brought to you by the fine folks at Gilt (http://github.com/gilt)

#cat ../etc/figlet

bold=$(tput bold)
underline=$(tput sgr 0 1)
reset=$(tput sgr0)

red=$(tput setaf 1)
gray=$(tput setaf 8)
white=$(tput setaf 7)

bin=`readlink -f $0`
dir=`dirname $bin`
figlet=$(cat $dir/../etc/figlet)
pkg=$(cat $dir/../package.json)

function version {
  prop='version'
  temp=`echo $pkg | sed 's/\\\\\//\//g' | sed 's/[{}]//g' | awk -v k="text" '{n=split($0,a,","); for (i=1; i<=n; i++) print a[i]}' | sed 's/\"\:\"/\|/g' | sed 's/[\,]/ /g' | sed 's/\"//g' | grep -w $prop | cut -d":" -f2 | sed -e 's/^ *//g' -e 's/ *$//g' `
  echo ${temp##*|}
}

echo "路\n路 ${bold}${white}hey guys! oh big gulps eh? - ${underline}${grey}http://youtu.be/praFGD51ih8${reset}\n路"
echo "路  ${bold}${red}Swig${reset}         v`version`"

# source nvm for this session
export NVM_DIR="$HOME/.nvm"
[ -s "$NVM_DIR/nvm.sh" ] && . "$NVM_DIR/nvm.sh"

# run node 0.11.n. allow errors to pass through to the user.
nvm use v0.11 >/dev/null

# TODO - check to see if swig is in this directory.
#        if not, ask the user if they want to init.

# pass control to gulp
node --harmony `which gulp` "$@"